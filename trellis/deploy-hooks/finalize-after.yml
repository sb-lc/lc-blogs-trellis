---
- name: WordPress Installed?
  command: wp core is-installed {{ project.multisite.enabled | default(false) | ternary('--network', '') }}
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  register: wp_installed
  changed_when: false
  failed_when: wp_installed.stderr != ""

- name: Update WP theme paths
  command: wp eval 'wp_clean_themes_cache(); switch_theme(get_stylesheet());'
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success

- name: Update WP database
  command: wp core update-db
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success and not project.multisite.enabled | default(false)

- name: Warn about updating network database.
  debug:
    msg: "Updating the network database could take a long time with a large number of sites."
  when: wp_installed | success and project.multisite.enabled | default(false)

- name: Update WP network database
  command: wp core update-db --network
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success and project.multisite.enabled | default(false)

- name: Reload php-fpm
  shell: sudo service php7.0-fpm reload
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
    warn: false

- name: Activate Timber Plugin
  command: wp plugin activate timber-library
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success

- name: Activate MCS Plugin
  command: wp plugin activate medusa-content-suite
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success

- name: Activate CMB2-Date-Range-Field Plugin
  command: wp plugin activate CMB2-Date-Range-Field
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success

- name: Activate Disable Comments Plugin
  command: wp plugin activate disable-comments
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success

- name: Activate Duplicate Post Plugin
  command: wp plugin activate duplicate-post
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success

- name: Activate Formidable
  command: wp plugin activate formidable
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success

- name: Activate LC Ajax Loader Plugin
  command: wp plugin activate lc-ajax-loader
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success

- name: Activate Ppen Graph Protocol Framework
  command: wp plugin activate open-graph-protocol-framework
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success

- name: Activate Paste as Plain Text
  command: wp plugin activate paste-as-plain-text
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success

- name: Activate WP Migrate DB Pro
  command: wp plugin activate wp-migrate-db-pro
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success

  - name: Activate WP Migrate DB Pro CLI
  command: wp plugin activate wp-migrate-db-pro-cli
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success

  - name: Activate WP Migrate DB Pro Media Files
  command: wp plugin activate wp-migrate-db-pro-media-files
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success









- name: Select Sage Timber LC Blogs Theme
  command: wp theme activate sage-timber-lc-blogs
  args:
    chdir: "{{ deploy_helper.new_release_path }}"
  when: wp_installed | success


